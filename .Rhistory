##question edited so that the Y/N response goes the same direction as the other questions
hds$Q79 <- as.character(hds$Q79)
hds[is.na(hds$Q79),]$Q79 <- "0"
hds[hds$Q79=="0",]$Q79 <- "0"
hds[hds$Q79=="1",]$Q79 <- "0"
hds[hds$Q79=="2",]$Q79 <- "1"
hds[hds$Q79=="100",]$Q79 <- "0"
hds$Q79 <- as.numeric(hds$Q79)
summary(hds$Q79)
hds$score <- hds$Q67 + hds$Q71 + hds$Q76 + hds$Q77 + hds$Q79
hds$score <- as.character(hds$score)
hds$score_bin <- hds$score
hds[hds$score_bin=="0",]$score_bin <- "None"
hds[hds$score_bin=="1",]$score_bin <- "Medium"
hds[hds$score_bin=="2",]$score_bin <- "Medium"
hds[hds$score_bin=="3",]$score_bin <- "High"
hds[hds$score_bin=="4",]$score_bin <- "High"
hds[hds$score_bin=="5",]$score_bin <- "High"
hds$score_bin <- factor(hds$score_bin, levels = c("None", "Medium", "High"))
summary(hds$score_bin)
iw.score <- full_join(iw.dm, hds, by = c("site"))
iw.score$pli.ln<- log(iw.score$pli)
#write.csv(iw.score, "score_test.csv")
iw.score[is.na(iw.score$score_bin),]$score_bin <- "None"
iw.score <- iw.score[!is.na(iw.score$community),]
table(iw.score$score_bin, iw.score$community)
#load libraries----
#base
library(readxl) #read excel files
library(tidyverse)
library(ggplot2)
#models
library(EnvStats)
library(lme4)
library(lmerTest)
library(ggeffects)
library(performance)
library(effects)
library(ggpubr)
library(emmeans)
library(multcomp)
library(car)
library(wesanderson)
hdslmerstepFX <- function(datalongDF, analyte.string, dfname.string){
dat <- datalongDF
analyte.s <- analyte.string
dfname <- dfname.string
#dat <- datlong[datlong$analyte == analyte.s,]
mm.0 <- lmer(data = dat,
log(concentration) ~
(1|site),
REML = F)
print(summary(mm.0))
assign(paste(analyte.s, dfname, ".0", sep = ""), mm.0, envir=.GlobalEnv)
mm.1 <- lmer(data = dat,
log(concentration) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mm.1))
assign(paste(analyte.s, dfname, ".1", sep = ""), mm.1, envir=.GlobalEnv)
mm.2.step <- step(mm.1)
#mm.2.step
#mm.2 <- get_model(mm.2.step)
#print(summary(mm.2))
#print(anova(mm.2))
assign(paste(analyte.s, dfname, ".2", sep = ""), mm.2, envir=.GlobalEnv)
}
#data formatting----
#iw.score contains samples with homes that had at least one response to the home description survey. if not all 5 questions were answered, a value of 0 was automatically assigned as a conservative assumption of behavior
#view(iw.score)
iw.score.long <- pivot_longer(data = iw.score,
cols = Be:Pb,
values_to = "concentration",
names_to = "analyte")
#split dataframe into different ones for each community
iws.c <- iw.score %>%
group_by(community) %>%
group_split()
iws.dh <- iws.c[[1]]
iws.gm <- iws.c[[2]]
iws.hw <- iws.c[[3]]
iws.tu <- iws.c[[4]]
#stepwise
#stepwise community modeling ----
contam_list <- list("Al", "Sb", "As", "Ba", "Be", "Cd", "Cr", "Co", "Cu", "Fe", "Pb", "Mn", "Mo", "Ni", "Se", "Ag", "Sn", "V", "Zn")
#split dataframe into different ones for each community
iws.c <- iw.score.long %>%
group_by(community) %>%
group_split()
iws.dh <- iws.c[[1]]
iws.gm <- iws.c[[2]]
iws.hw <- iws.c[[3]]
iws.tu <- iws.c[[4]]
hdslmerstepFX(datalongDF = iws.dh[iws.dh$analyte == "Mn",],
analyte.string = "Mn",
dfname.string = ".dh")
#split dataframe into different ones for each community
iws.c <- iw.score %>%
group_by(community) %>%
group_split()
iws.dh <- iws.c[[1]]
iws.gm <- iws.c[[2]]
iws.hw <- iws.c[[3]]
iws.tu <- iws.c[[4]]
## dh ----
###Mn ----
mn.dh.0 <- lmer(data = iws.dh,
log(Mn) ~
(1|site),
REML = F)
print(summary(mn.dh.0))
mn.dh.1 <- lmer(data = iws.dh,
log(Mn) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mn.dh.1))
mn.dh.2.step <- step(mn.dh.1)
mn.dh.2.step
mn.dh.2 <- get_model(mn.dh.2.step)
print(summary(mn.dh.2))
print(anova(mn.dh.2))
anova(mn.dh.1)
###Ba ----
ba.dh.0 <- lmer(data = iws.dh,
log(Ba) ~
(1|site),
REML = F)
print(summary(ba.dh.0))
ba.dh.1 <- lmer(data = iws.dh,
log(Ba) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(ba.dh.1))
ba.dh.2.step <- step(ba.dh.1)
ba.dh.2.step
ba.dh.2 <- get_model(ba.dh.2.step)
print(summary(ba.dh.2))
anova(ba.dh.1)
print(anova(ba.dh.2))
###Mo ----
mo.dh.0 <- lmer(data = iws.dh,
log(Mo) ~
(1|site),
REML = F)
print(summary(mo.dh.0))
mo.dh.1 <- lmer(data = iws.dh,
log(Mo) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mo.dh.1))
mo.dh.2.step <- step(mo.dh.1)
mo.dh.2.step
mo.dh.2 <- get_model(mo.dh.2.step)
print(summary(mo.dh.2))
anova(mo.dh.1)
print(anova(mo.dh.2))
###Ni ----
ni.dh.0 <- lmer(data = iws.dh,
log(Ni) ~
(1|site),
REML = F)
print(summary(ni.dh.0))
ni.dh.1 <- lmer(data = iws.dh,
log(Ni) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(ni.dh.1))
ni.dh.2.step <- step(ni.dh.1)
ni.dh.2.step
ni.dh.2 <- get_model(ni.dh.2.step)
print(summary(ni.dh.2))
anova(ni.dh.1)
print(anova(ni.dh.2))
###V ----
v.dh.0 <- lmer(data = iws.dh,
log(V) ~
(1|site),
REML = F)
print(summary(v.dh.0))
v.dh.1 <- lmer(data = iws.dh,
log(V) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(v.dh.1))
v.dh.2.step <- step(v.dh.1)
v.dh.2.step
v.dh.2 <- get_model(v.dh.2.step)
print(summary(v.dh.2))
anova(v.dh.1)
print(anova(v.dh.2))
## gm ----
###V ----
v.gm.0 <- lmer(data = iws.gm,
log(V) ~
(1|site),
REML = F)
print(summary(v.gm.0))
v.gm.1 <- lmer(data = iws.gm,
log(V) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(v.gm.1))
v.gm.2.step <- step(v.gm.1)
v.gm.2.step
v.gm.2 <- get_model(v.gm.2.step)
print(summary(v.gm.2))
anova(v.gm.1)
print(anova(v.gm.2))
###Co ----
co.gm.0 <- lmer(data = iws.gm,
log(Co) ~
(1|site),
REML = F)
print(summary(co.gm.0))
co.gm.1 <- lmer(data = iws.gm,
log(Co) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(co.gm.1))
co.gm.2.step <- step(co.gm.1)
co.gm.2.step
co.gm.2 <- get_model(co.gm.2.step)
print(summary(co.gm.2))
anocoa(co.gm.1)
anova(co.gm.1)
print(anocoa(co.gm.2))
print(summary(co.gm.2))
print(anova(co.gm.2))
###Mn ----
mn.gm.0 <- lmer(data = iws.gm,
log(Mn) ~
(1|site),
REML = F)
print(summary(mn.gm.0))
mn.gm.1 <- lmer(data = iws.gm,
log(Mn) ~ season + prox.normal + smnre_bin +
(1|site),
REML = F)
print(summary(mn.gm.1))
mn.gm.1 <- lmer(data = iws.gm,
log(Mn) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mn.gm.1))
mn.gm.2.step <- step(mn.gm.1)
mn.gm.2.step
mn.gm.2 <- get_model(mn.gm.2.step)
print(summary(mn.gm.2))
print(summary(mn.gm.2))
anova(mn.gm.1)
print(anova(mn.gm.2))
mn.gm.2.step
###Al ----
al.gm.0 <- lmer(data = iws.gm,
log(Al) ~
(1|site),
REML = F)
print(summary(al.gm.0))
al.gm.1 <- lmer(data = iws.gm,
log(Al) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(al.gm.1))
al.gm.2.step <- step(al.gm.1)
al.gm.2.step
al.gm.2 <- get_model(al.gm.2.step)
print(summary(al.gm.2))
anova(al.gm.1)
print(anova(al.gm.2))
al.gm.2.step
print(summary(al.gm.2))
###Cr ----
cr.gm.0 <- lmer(data = iws.gm,
log(Cr) ~
(1|site),
REML = F)
print(summary(cr.gm.0))
cr.gm.1 <- lmer(data = iws.gm,
log(Cr) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(cr.gm.1))
cr.gm.2.step <- step(cr.gm.1)
cr.gm.2.step
cr.gm.2 <- get_model(cr.gm.2.step)
print(summary(cr.gm.2))
anova(cr.gm.1)
print(anova(cr.gm.2))
## hw ----
###Mn ----
mn.hw.0 <- lmer(data = iws.hw,
log(Mn) ~
(1|site),
REML = F)
print(summary(mn.hw.0))
mn.hw.1 <- lmer(data = iws.hw,
log(Mn) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mn.hw.1))
mn.hw.2.step <- step(mn.hw.1)
mn.hw.2.step
mn.hw.2 <- get_model(mn.hw.2.step)
print(summary(mn.hw.2))
anova(mn.hw.1)
print(anova(mn.hw.2))
###Cu ----
cu.hw.0 <- lmer(data = iws.hw,
log(Cu) ~
(1|site),
REML = F)
print(summary(cu.hw.0))
cu.hw.1 <- lmer(data = iws.hw,
log(Cu) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(cu.hw.1))
cu.hw.2.step <- step(cu.hw.1)
cu.hw.2.step
cu.hw.2 <- get_model(cu.hw.2.step)
print(summary(cu.hw.2))
anova(cu.hw.1)
print(anova(cu.hw.2))
###As ----
as.hw.0 <- lmer(data = iws.hw,
log(As) ~
(1|site),
REML = F)
print(summary(as.hw.0))
as.hw.1 <- lmer(data = iws.hw,
log(As) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(as.hw.1))
as.hw.2.step <- step(as.hw.1)
as.hw.2.step
as.hw.2 <- get_model(as.hw.2.step)
print(summary(as.hw.2))
anova(as.hw.1)
print(anova(as.hw.2))
vif(as.hw.2)
vif(as.hw.1)
###Pb ----
pb.hw.0 <- lmer(data = iws.hw,
log(Pb) ~
(1|site),
REML = F)
print(summary(pb.hw.0))
pb.hw.1 <- lmer(data = iws.hw,
log(Pb) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(pb.hw.1))
pb.hw.2.step <- step(pb.hw.1)
pb.hw.2.step
pb.hw.2 <- get_model(pb.hw.2.step)
print(summary(pb.hw.2))
anova(pb.hw.1)
print(anova(pb.hw.2))
print(summary(as.hw.2))
p
print(summary(pb.hw.2))
###Co ----
co.hw.0 <- lmer(data = iws.hw,
log(Co) ~
(1|site),
REML = F)
print(summary(co.hw.0))
co.hw.1 <- lmer(data = iws.hw,
log(Co) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(co.hw.1))
co.hw.2.step <- step(co.hw.1)
co.hw.2.step
co.hw.2 <- get_model(co.hw.2.step)
print(summary(co.hw.2))
anova(co.hw.1)
print(anova(co.hw.2))
co.hw.2.step
anova(co.hw.1)
anova(co.hw.2)
print(summary(co.hw.2))
print(summary(co.hw.1))
## tu ----
###Mn ----
mn.tu.0 <- lmer(data = iws.tu,
log(Mn) ~
(1|site),
REML = F)
print(summary(mn.tu.0))
mn.tu.1 <- lmer(data = iws.tu,
log(Mn) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mn.tu.1))
mn.tu.2.step <- step(mn.tu.1)
mn.tu.2.step <- step(mn.tu.1)
## tu ----
###Mn ----
mn.tu.0 <- lmer(data = iws.tu,
log(Mn) ~
(1|site),
REML = F)
print(summary(mn.tu.0))
mn.tu.1 <- lmer(data = iws.tu,
log(Mn) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mn.tu.1))
mn.tu.2.step <- step(mn.tu.1)
mn.tu.2.step
summary(iws.tu$prox.normal)
iws.tu <- iws.tu %>%
drop_na(prox.normal)
summary(iws.tu$prox.normal)
## tu ----
###Mn ----
mn.tu.0 <- lmer(data = iws.tu,
log(Mn) ~
(1|site),
REML = F)
print(summary(mn.tu.0))
mn.tu.1 <- lmer(data = iws.tu,
log(Mn) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(mn.tu.1))
mn.tu.2.step <- step(mn.tu.1)
mn.tu.2.step
mn.tu.2 <- get_model(mn.tu.2.step)
print(summary(mn.tu.2))
anova(mn.tu.1)
print(anova(mn.tu.2))
###Co ----
co.tu.0 <- lmer(data = iws.tu,
log(Co) ~
(1|site),
REML = F)
print(summary(co.tu.0))
co.tu.1 <- lmer(data = iws.tu,
log(Co) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(co.tu.1))
co.tu.2.step <- step(co.tu.1)
co.tu.2.step
co.tu.2 <- get_model(co.tu.2.step)
print(summary(co.tu.2))
anova(co.tu.1)
print(anova(co.tu.2))
###Ni ----
ni.tu.0 <- lmer(data = iws.tu,
log(Ni) ~
(1|site),
REML = F)
print(summary(ni.tu.0))
ni.tu.1 <- lmer(data = iws.tu,
log(Ni) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(ni.tu.1))
ni.tu.2.step <- step(ni.tu.1)
ni.tu.2.step
ni.tu.2 <- get_model(ni.tu.2.step)
print(summary(ni.tu.2))
anova(ni.tu.1)
print(anova(ni.tu.2))
ni.tu.1
summary(ni.tu.1)
###Zn ----
zn.tu.0 <- lmer(data = iws.tu,
log(Zn) ~
(1|site),
REML = F)
print(summary(zn.tu.0))
zn.tu.1 <- lmer(data = iws.tu,
log(Zn) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(zn.tu.1))
zn.tu.2.step <- step(zn.tu.1)
zn.tu.2.step
zn.tu.2 <- get_model(zn.tu.2.step)
print(summary(zn.tu.2))
anova(zn.tu.1)
print(anova(zn.tu.2))
print(summary(ni.tu.2))
###Ba ----
ba.tu.0 <- lmer(data = iws.tu,
log(Ba) ~
(1|site),
REML = F)
print(summary(ba.tu.0))
ba.tu.1 <- lmer(data = iws.tu,
log(Ba) ~ season + prox.normal + score_bin +
(1|site),
REML = F)
print(summary(ba.tu.1))
ba.tu.2.step <- step(ba.tu.1)
ba.tu.2.step
ba.tu.2 <- get_model(ba.tu.2.step)
print(summary(ba.tu.2))
anova(ba.tu.1)
print(anova(ba.tu.2))
print(summary(al.gm.2))
print(summary(mn.hw.2))
print(summary(cu.hw.2))
print(summary(as.hw.2))
print(summary(pb.hw.2))
print(summary(co.hw.2))
print(summary(zn.tu.2))
