#load data
#IW DM
iw.dm <- read_xlsx("/users/kunalpalawat/Documents/GitHub/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected", col_names = TRUE) #corrected mean the corrected tab in the excel sheet
#load libraries ----
library(readxl) #read excel files
library(tidyverse)
#load data
#IW DM
iw.dm <- read_xlsx("/users/kunalpalawat/Documents/GitHub/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected", col_names = TRUE) #corrected mean the corrected tab in the excel sheet
getwd()
#load data
#IW DM
iw.dm <- read_xlsx("../WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected", col_names = TRUE) #corrected mean the corrected tab in the excel sheet
#load data
#IW DM
iw.dm <- read_xlsx("../../WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected", col_names = TRUE) #corrected mean the corrected tab in the excel sheet
#load data
#IW DM
iw.dm <- read_xlsx("./WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected", col_names = TRUE) #corrected mean the corrected tab in the excel sheet
#load data
#IW DM
iw.dm <- read_xlsx("././WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected", col_names = TRUE) #corrected mean the corrected tab in the excel sheet
#load data
#IW DM
iw_dm <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected") #corrected mean the corrected tab in the excel sheet
#wrangle data
#add period and season variables
iw.dm$period <- iw.dm$samplings
#load data
#IW DM
iw.dm <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected") #corrected mean the corrected tab in the excel sheet
#load data
#IW DM
iw.dm <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected") #corrected mean the corrected tab in the excel sheet
#wrangle data
#add period and season variables
iw.dm$period <- iw.dm$samplings
iw.dm$season <- iw.dm$samplings
#redefine them
iw.dm[iw.dm$period=="First Winter",]$period <- "First"
iw.dm[iw.dm$period=="Last Winter",]$period <- "Last"
iw.dm[iw.dm$period=="First Monsoon",]$period <- "First"
iw.dm[iw.dm$period=="Last Monsoon",]$period <- "Last"
iw.dm[iw.dm$season=="First Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="Last Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="First Monsoon",]$season <- "Monsoon"
iw.dm[iw.dm$season=="Last Monsoon",]$season <- "Monsoon"
#changing year #Make a new variable with this
iw.dm$year <- iw.dm$sampling_year
iw.dm[iw.dm$year=="2017-2018",]$year <- "Water Year 1"
iw.dm[iw.dm$year=="2018-2019",]$year <- "Water Year 2"
iw.dm[iw.dm$year=="2019-2020",]$year <- "Water Year 3"
#remove field blanks. to remove anything, use a type!="VAlue" to remove them.
iw.dm <- iw.dm[iw.dm$type!="B", ]
iw.dm.detects <- iw.dm.detects[iw.dm.detects$type!="B", ]
#wrangle data
#add period and season variables
iw.dm$period <- iw.dm$samplings
iw.dm$season <- iw.dm$samplings
#redefine them
iw.dm[iw.dm$period=="First Winter",]$period <- "First"
iw.dm[iw.dm$period=="Last Winter",]$period <- "Last"
iw.dm[iw.dm$period=="First Monsoon",]$period <- "First"
iw.dm[iw.dm$period=="Last Monsoon",]$period <- "Last"
iw.dm[iw.dm$season=="First Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="Last Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="First Monsoon",]$season <- "Monsoon"
iw.dm[iw.dm$season=="Last Monsoon",]$season <- "Monsoon"
#changing year #Make a new variable with this
iw.dm$year <- iw.dm$sampling_year
iw.dm[iw.dm$year=="2017-2018",]$year <- "Water Year 1"
iw.dm[iw.dm$year=="2018-2019",]$year <- "Water Year 2"
iw.dm[iw.dm$year=="2019-2020",]$year <- "Water Year 3"
#remove field blanks. to remove anything, use a type!="VAlue" to remove them.
iw.dm <- iw.dm[iw.dm$type!="B", ]
iw.dm.detects <- iw.dm.detects[iw.dm.detects$type!="B", ]
#load data
#IW DM
iw.dm <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected") #corrected mean the corrected tab in the excel sheet
#wrangle data
#add period and season variables
iw.dm$period <- iw.dm$samplings
iw.dm$season <- iw.dm$samplings
#redefine them
iw.dm[iw.dm$period=="First Winter",]$period <- "First"
iw.dm[iw.dm$period=="Last Winter",]$period <- "Last"
iw.dm[iw.dm$period=="First Monsoon",]$period <- "First"
iw.dm[iw.dm$period=="Last Monsoon",]$period <- "Last"
iw.dm[iw.dm$season=="First Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="Last Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="First Monsoon",]$season <- "Monsoon"
iw.dm[iw.dm$season=="Last Monsoon",]$season <- "Monsoon"
#changing year #Make a new variable with this
iw.dm$year <- iw.dm$sampling_year
iw.dm[iw.dm$year=="2017-2018",]$year <- "Water Year 1"
iw.dm[iw.dm$year=="2018-2019",]$year <- "Water Year 2"
iw.dm[iw.dm$year=="2019-2020",]$year <- "Water Year 3"
#remove field blanks. to remove anything, type !="Value" to remove them.
iw.dm <- iw.dm[iw.dm$type!="B", ]
#remove ATS samples because ATS samples are not included in PH research.
iw.dm <- iw.dm[iw.dm$site!="ATS1", ]
#remove year 3 monsoon samples
iw.dm$ssnyear <- paste(iw.dm$season, iw.dm$year)
iw.dm <- iw.dm[iw.dm$ssnyear!="Monsoon Water Year 3", ]
#confirm correct order of categorical variables
#iw.dm$samplings <- factor(iw.dm$samplings, levels = c("FW", "LW", "FM", "LM"))
iw.dm$samplings <- factor(iw.dm$samplings, levels = c("First Winter", "Last Winter", "First Monsoon", "Last Monsoon"))
iw.dm$period <- factor(iw.dm$period, levels = c("First", "Last"))
iw.dm$season <- factor(iw.dm$season, levels = c("Winter", "Monsoon"))
iw.dm$sampling_year <- factor(iw.dm$sampling_year, levels = c("Water Year 1", "Water Year 2", "Water Year 3"))
iw.dm$community <- factor(iw.dm$community, levels = c("Dewey-Humboldt", "Globe/Miami", "Hayden/Winkelman", "Tucson"))
#pH and EC data
#append pH and EC data
iw.pHec <- read_xlsx("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_pHEC_Y123.xlsx", sheet = 1, col_names = TRUE)
iw.pHec <- iw.pHec[iw.pHec$type!="B",] #removing field blanks
iw.dm <- full_join(iw.dm, iw.pHec, by = c("sample.name", "type")) #joins the phec data with the original iw.dm we had before
iw.dm <- iw.dm[!is.na(iw.dm$community),]
na.omit(iw.dm$community)
#pH and EC data
#append pH and EC data
iw.pHec <- read_xlsx("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_pHEC_Y123.xlsx", sheet = 1, col_names = TRUE)
iw.pHec <- iw.pHec[iw.pHec$type!="B",] #removing field blanks
iw.dm <- full_join(iw.dm, iw.pHec, by = c("sample.name", "type")) #joins the phec data with the original iw.dm we had before
iw.dm <- iw.dm[!is.na(iw.dm$community),]
#load data
#IW DM
iw.dm <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected") #corrected mean the corrected tab in the excel sheet
# iw.dm.detects <- read_xlsx("data/data_clean/IW_DM_Y123.xlsx", sheet = "Detection", col_names = TRUE)
# mlod <- read_xlsx("data/data_processing/IPSW_MLODS.xlsx", sheet = "corrected - 12.22.20", col_names = TRUE)
# iw.mlod <- mlod[mlod$`Sample Type`=="IW",]
# iw.mlod.dm <- iw.mlod[iw.mlod$Analysis=="DM",]
#wrangle data
#add period and season variables
iw.dm$period <- iw.dm$samplings
iw.dm$season <- iw.dm$samplings
#redefine them
iw.dm[iw.dm$period=="First Winter",]$period <- "First"
iw.dm[iw.dm$period=="Last Winter",]$period <- "Last"
iw.dm[iw.dm$period=="First Monsoon",]$period <- "First"
iw.dm[iw.dm$period=="Last Monsoon",]$period <- "Last"
iw.dm[iw.dm$season=="First Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="Last Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="First Monsoon",]$season <- "Monsoon"
iw.dm[iw.dm$season=="Last Monsoon",]$season <- "Monsoon"
#changing year #Make a new variable with this
iw.dm$year <- iw.dm$sampling_year
iw.dm[iw.dm$year=="2017-2018",]$year <- "Water Year 1"
iw.dm[iw.dm$year=="2018-2019",]$year <- "Water Year 2"
iw.dm[iw.dm$year=="2019-2020",]$year <- "Water Year 3"
#remove field blanks. to remove anything, type !="Value" to remove them.
iw.dm <- iw.dm[iw.dm$type!="B", ]
#remove ATS samples because ATS samples are not included in PH research.
iw.dm <- iw.dm[iw.dm$site!="ATS1", ]
#remove year 3 monsoon samples
iw.dm$ssnyear <- paste(iw.dm$season, iw.dm$year)
iw.dm <- iw.dm[iw.dm$ssnyear!="Monsoon Water Year 3", ]
#confirm correct order of categorical variables
#iw.dm$samplings <- factor(iw.dm$samplings, levels = c("FW", "LW", "FM", "LM"))
iw.dm$samplings <- factor(iw.dm$samplings, levels = c("First Winter", "Last Winter", "First Monsoon", "Last Monsoon"))
iw.dm$period <- factor(iw.dm$period, levels = c("First", "Last"))
iw.dm$season <- factor(iw.dm$season, levels = c("Winter", "Monsoon"))
iw.dm$sampling_year <- factor(iw.dm$sampling_year, levels = c("Water Year 1", "Water Year 2", "Water Year 3"))
iw.dm$community <- factor(iw.dm$community, levels = c("Dewey-Humboldt", "Globe/Miami", "Hayden/Winkelman", "Tucson"))
#pH and EC data
#append pH and EC data
iw.pHec <- read_xlsx("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_pHEC_Y123.xlsx", sheet = 1, col_names = TRUE)
iw.pHec <- iw.pHec[iw.pHec$type!="B",] #removing field blanks
iw.dm <- full_join(iw.dm, iw.pHec, by = c("sample.name", "type")) #joins the phec data with the original iw.dm we had before
iw.dm <- iw.dm[!is.na(iw.dm$community),]
na.omit(iw.dm$community)
library(car)
library(readxl)
library(tidyverse)
library(ggplot2)
library(EnvStats)
library(lme4)
library(lmerTest)
library(performance)
library(effects)
library(ggeffects)
library(ggpubr)
library(emmeans)
library(multcomp)
library(patchwork)
#set working directory
#setwd("/users/godsgiftnkechichukwuonye/Documents/GitHub/WorkingFiles/data/data_processing")
setwd("~/Documents/GitHub/ProjectHarvest/WorkingFiles//data/data_processing")
#load data
ic.dm <- read_xlsx("IC_DMTM_Y23.xlsx", sheet = "Corrected - DM", col_names = TRUE)
ic.dm$community <- "AZ-Background" #changes community to AZ background
#add period and season variables
ic.dm$period <- ic.dm$samplings
ic.dm$season <- ic.dm$samplings
#redefine them
ic.dm[ic.dm$period=="First Winter",]$period <- "First"
ic.dm[ic.dm$period=="Last Winter",]$period <- "Last"
ic.dm[ic.dm$period=="First Monsoon",]$period <- "First"
ic.dm[ic.dm$period=="Last Monsoon",]$period <- "Last"
ic.dm[ic.dm$season=="First Winter",]$season <- "Winter"
ic.dm[ic.dm$season=="Last Winter",]$season <- "Winter"
ic.dm[ic.dm$season=="First Monsoon",]$season <- "Monsoon"
ic.dm[ic.dm$season=="Last Monsoon",]$season <- "Monsoon"
#combine water dm files together
dat <- bind_rows(iw.dm, ic.dm) #binds iw to ic
#define factors
dat$community <- factor(dat$community, levels = c("AZ-Background", "Dewey-Humboldt", "Globe/Miami", "Hayden/Winkelman", "Tucson"))
#dat$community <- factor(dat$community, levels = c("Dewey-Humboldt", "Globe/Miami", "Hayden/Winkelman", "Tucson", "Chiricahua", "Grand Canyon", "Oliver Knoll", "Organ Pipe", "Petrified Forest"))
dat$samplings <- factor(dat$samplings, levels = c("First Winter", "Last Winter", "First Monsoon", "Last Monsoon"))
dat$period <- factor(dat$period, levels = c("First", "Last"))
dat$season <- factor(dat$season, levels = c("Winter", "Monsoon"))
dat.long <- pivot_longer(data = dat,
cols = Be:Pb,
names_to = "analyte",
values_to = "value")
setwd("/users/godsgiftnkechichukwuonye/Desktop/PhD Stuff/PH_Figures")
setwd("~/Documents/GitHub/project-harvest-GC/Figures")
#summary stats community ----
dat %>% count(community)
View(ic.dm)
#graphing
dat$community_short <- as.character(dat$community)
dat[dat$community_short=="Dewey-Humboldt",]$community_short <- "DH"
dat[dat$community_short=="Globe/Miami",]$community_short <- "GM"
dat[dat$community_short=="Hayden/Winkelman",]$community_short <- "HW"
dat[dat$community_short=="Tucson",]$community_short <- "TU"
dat[dat$community_short=="AZ-Background",]$community_short <- "AZ"
dat$community_short <- factor(dat$community_short, levels = c("DH", "GM", "HW", "TU", "AZ"))
summary(dat$community_short)
ggplot(data = dat,
mapping = aes(x=community_short,
y=Al))+
geom_boxplot() +
stat_boxplot(geom = 'errorbar') +
facet_wrap(.~samplings)+
labs(y = expression(paste("Al Concentration (µg ",L^-1, ")", "\n")),
x = paste("\nCommunity"))+
theme_bw() +
theme(text = element_text(size=7, family = "Arial"),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.line.y = element_blank(),
axis.line.x = element_blank())
ggplot(data = dat,
mapping = aes(x=community_short,
y=Al))+
geom_boxplot() +
stat_boxplot(geom = 'errorbar') +
facet_wrap(.~samplings, scales = "free.y")+
labs(y = expression(paste("Al Concentration (µg ",L^-1, ")", "\n")),
x = paste("\nCommunity"))+
theme_bw() +
theme(text = element_text(size=7, family = "Arial"),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.line.y = element_blank(),
axis.line.x = element_blank())
ggplot(data = dat,
mapping = aes(x=community_short,
y=Al))+
geom_boxplot() +
stat_boxplot(geom = 'errorbar') +
facet_wrap(.~samplings, scales = "free_y")+
labs(y = expression(paste("Al Concentration (µg ",L^-1, ")", "\n")),
x = paste("\nCommunity"))+
theme_bw() +
theme(text = element_text(size=7, family = "Arial"),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.line.y = element_blank(),
axis.line.x = element_blank())
ggplot(data = dat,
mapping = aes(x=community_short,
y=Al))+
geom_boxplot() +
stat_boxplot(geom = 'errorbar') +
facet_wrap(.~samplings)+
labs(y = expression(paste("Al Concentration (µg ",L^-1, ")", "\n")),
x = paste("\nCommunity"))+
coord_cartesian(ylim = c(0, 1000)) +
theme_bw() +
theme(text = element_text(size=7, family = "Arial"),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(),
axis.line.y = element_blank(),
axis.line.x = element_blank())
#As Ctrl Modeling ----
#basic viz
boxplot(dat$Al ~ dat$community, log = "y")
boxplot(dat$Al ~ dat$samplings, log = "y")
Al0 <- lmer(data = dat,
log(Al) ~ (1|community:site),
REML = T)
summary(Al0)
Al1 <- lmer(data = dat,
log(Al) ~ community+period+season+community:period+community:season+period:season+community:period:season
+ (1|community:site),
REML = T)
summary(Al1)
step(Al1, scope=list(lower=Al0), direction="backward")
Al1b <- lmer(data = dat,
log(Al) ~ community + period + season + (1 | community:site) + community:season + period:season,
REML = T)
summary(Al1b)
#As Ctrl Modeling ----
#basic viz
boxplot(dat$Al ~ dat$community, log = "y")
boxplot(dat$Al ~ dat$samplings, log = "y")
summary(Al1)
VIF(Al1)
vif(Al1)
Al2 <- lmer(data = dat,
log(As) ~ community+period+season+community:period+period:season+community:period:season
+ (1|community:site),
REML = F)
vif(Al2)
Al3 <- lmer(data = dat,
log(Al) ~ community+period+season+community:period+period:season
+ (1|community:site),
REML = F)
vif(Al3)
Al4 <- lmer(data = dat,
log(Al) ~ community+period+season+period:season
+ (1|community:site),
REML = T)
anova(Al4)
vif(Al4)
summary(Al4)
summary(Al4)
Al5b <- lmer(data = dat,
log(Al) ~ community+season+period:season
+ (1|community:site),
REML = T)
anova(Al5b)
summary(Al5b)
anova(Al4)
anova(Al1,Al5)
#why was period:season taken out and not just period?
Al5 <- lmer(data = dat,
log(Al) ~ community+season
+ (1|community:site),
REML = T)
anova(Al1,Al5)
anova(Al4, Al5)
anova(Al4, Al5b)
anova(Al5, Al5b)
#Exploratory PCA ----
#only for numeric variables
#unscaled
library(vegan)
View(iw.dm)
iwdm.pca <- rda(as.data.frame(iw.dm[,9:27]), scale = T)
summary(iwdm.pca)
iwdm.pca <- rda(as.data.frame(iw.dm[,9:27&32&34]), scale = T)
iwdm.pca <- rda(as.data.frame(iw.dm[,c(9:27,32,34)]), scale = T)
anova(Al4)
vif(Al4)
anova(Al4)
summary(Al4)
anova(Al4, Al5b)
anova(Al4)
anova(Al4, Al5b)
anova(Al5, Al5b)
