aial.gm.0 <- glm(data = exgm[exgm$standard=="AI"&exgm$analyte=="Cu",],
exceedance ~ 1,
family = "binomial")
##!!!copper ----
### gm ----
### not enough data to really analyze this, season is not significant on its own
aicu.gm.0 <- glm(data = exgm[exgm$standard=="AI"&exgm$analyte=="Cu",],
exceedance ~ 1,
family = "binomial")
#maximal.gm model
aicu.gm.1 <- glm(data = exgm[exgm$standard=="AI"&exgm$analyte=="Cu",],
exceedance ~ season,
family = "binomial")
summary(aicu.gm.1)
exp(coef(aicu.gm.1))
aicu.gm.2 <- stepAIC(aicu.gm.0,scope = list(upper=aicu.gm.1), direction="both", trace = T)
#maximal.gm model
aicu.gm.1 <- glm(data = exgm[exgm$standard=="AI"&exgm$analyte=="Cu",],
exceedance ~ season +proximity.km,
family = "binomial")
summary(aicu.gm.1)
aicu.gm.2 <- stepAIC(aicu.gm.0,scope = list(upper=aicu.gm.1), direction="both", trace = T)
summary(aicu.gm.2) #no significant community effect
### hw ----
### not enough data to really analyze this, season and proximity is not significant on its own or together
aicu.hw.0 <- glm(data = exhw[exhw$standard=="AI"&exhw$analyte=="Cu",],
exceedance ~ 1,
family = "binomial")
#maximal.hw model
aicu.hw.1 <- glm(data = exhw[exhw$standard=="AI"&exhw$analyte=="Cu",],
exceedance ~ season,
family = "binomial")
summary(aicu.hw.1)
#maximal.hw model
aicu.hw.1 <- glm(data = exhw[exhw$standard=="AI"&exhw$analyte=="Cu",],
exceedance ~ proximity.km,
family = "binomial")
summary(aicu.hw.1)
#maximal.hw model
aicu.hw.1 <- glm(data = exhw[exhw$standard=="AI"&exhw$analyte=="Cu",],
exceedance ~ proximity.km + season,
family = "binomial")
summary(aicu.hw.1)
vif(aicu.hw.1)
check_model(aicu.hw.1)
exp(coef(aicu.hw.1))
performance(aicu.hw.1)
aicu.hw.2 <- stepAIC(aicu.hw.0,scope = list(upper=aicu.hw.1), direction="both", trace = T)
summary(aicu.hw.2) #no significant community effect
exp(coef(aicu.hw.2))
#get confidence interval.gms for estimates
se <- sqrt(diag(vcov(aicu.hw.2)))
# table of estimates with 95% CI
(tab <- cbind(Est = fixef(aicu.gm.1), LL = fixef(aicu.gm.1) - 1.96 * se, UL = fixef(aicu.gm.1) + 1.96 *
se))
### tu ----
aicu.tu.0 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Cu",],
exceedance ~ 1,
family = "binomial")
#maximal.tu model
aicu.tu.1 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Cu",],
exceedance ~ proximity.km + season,
family = "binomial")
summary(aicu.tu.1)
aicu.tu.2 <- stepAIC(aicu.tu.0,scope = list(upper=aicu.tu.1), direction="both", trace = T)
summary(aicu.tu.2) #both variables significant with a trend that makes sense
#maximal.tu model
aicu.tu.1 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Cu",],
exceedance ~ season,
family = "binomial")
summary(aicu.tu.1)
aicu.tu.2 <- stepAIC(aicu.tu.0,scope = list(upper=aicu.tu.1), direction="both", trace = T)
summary(aicu.tu.2) #both variables significant with a trend that makes sense
#maximal.tu model
aicu.tu.1 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Cu",],
exceedance ~ proximity.km,
family = "binomial")
summary(aicu.tu.1)
aicu.tu.2 <- stepAIC(aicu.tu.0,scope = list(upper=aicu.tu.1), direction="both", trace = T)
summary(aicu.tu.2) #both variables significant with a trend that makes sense
##manganese ----
### dh ----
### gm ----
aimn.gm.0 <- glm(data = exgm[exgm$standard=="AI"&exgm$analyte=="Mn",],
exceedance ~ 1,
family = "binomial")
#maximal.gm model
aimn.gm.1 <- glm(data = exgm[exgm$standard=="AI"&exgm$analyte=="Mn",],
exceedance ~ season +proximity.km,
family = "binomial")
summary(aimn.gm.1)
aimn.gm.2 <- stepAIC(aimn.gm.0,scope = list(upper=aimn.gm.1), direction="both", trace = T)
summary(aimn.gm.2) #no significant variable effect
#maximal.gm model
aimn.gm.1 <- glm(data = exgm[exgm$standard=="AI"&exgm$analyte=="Mn",],
exceedance ~ season,
family = "binomial")
summary(aimn.gm.1)
##molybdenum ----
### dh ----
### hw ----
### tu ----
aimo.tu.0 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Mo",],
exceedance ~ 1,
family = "binomial")
#maximal.tu model
aimo.tu.1 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Mo",],
exceedance ~ proximity.km,
family = "binomial")
summary(aimo.tu.1)
#maximal.tu model
aimo.tu.1 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Mo",],
exceedance ~ season,
family = "binomial")
summary(aimo.tu.1)
#maximal.tu model
aimo.tu.1 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Mo",],
exceedance ~ season +proximity.km,
family = "binomial")
summary(aimo.tu.1)
aimo.tu.2 <- stepAIC(aimo.tu.0,scope = list(upper=aimo.tu.1), direction="both", trace = T)
summary(aimo.tu.2) #no significance
exp(coef(aimo.tu.2))
##zinc ----
### dh ----
### gm ----
### hw ----
### tu ----
aizn.tu.0 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Zn",],
exceedance ~ 1,
family = "binomial")
#maximal.hw model
aizn.tu.1 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Zn",],
exceedance ~ season + proximity.km,
family = "binomial")
aizn.tu.2 <- stepAIC(aizn.tu.0,scope = list(upper=aizn.tu.1), direction="both", trace = T)
summary(aizn.tu.2) #no significant community effect
summary(aimn.gm.2) #prox still significant
summary(aimo.tu.2) #season almost signif
summary(aizn.tu.2) #no significant community effect
#FB/PB ----
##lead ----
### tu ----
fpbpb.tu.0 <- glm(data = extu[extu$standard=="AI"&extu$analyte=="Pb",],
exceedance ~ 1,
family = "binomial")
#FB/PB ----
##lead ----
### tu ----
fpbpb.tu.0 <- glm(data = extu[extu$standard=="FB"&extu$analyte=="Pb",],
exceedance ~ 1,
family = "binomial")
#maximal.hw model
fpbpb.tu.1 <- glm(data = extu[extu$standard=="FB"&extu$analyte=="Pb",],
exceedance ~ season + proximity.km,
family = "binomial")
summary(fpbpb.tu.1)
fpbpb.tu.2 <- stepAIC(fpbpb.tu.0,scope = list(upper=fpbpb.tu.1), direction="both", trace = T)
summary(fpbpb.tu.2) #no significant community effect
view(com)
#Kunal Palawat and Gift Chukwuonye
#Description: Script to load and clean up datasets for analysis. RUN THIS every time before coding.
#
#Load libraries====
library(readxl) #read excel files
library(tidyverse)
library(ggplot2)
library(table1)
iw.dm <- read_xlsx("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_DM_Y123.xlsx", sheet = "Corrected")
# iw.dm.detects <- read_xlsx("data/data_clean/IW_DM_Y123.xlsx", sheet = "Detection", col_names = TRUE)
# mlod <- read_xlsx("data/data_processing/IPSW_MLODS.xlsx", sheet = "corrected - 12.22.20", col_names = TRUE)
# iw.mlod <- mlod[mlod$`Sample Type`=="IW",]
# iw.mlod.dm <- iw.mlod[iw.mlod$Analysis=="DM",]
#wrangle data
#add period and season variables
iw.dm$period <- iw.dm$samplings
iw.dm$season <- iw.dm$samplings
#redefine them
iw.dm[iw.dm$period=="First Winter",]$period <- "First"
iw.dm[iw.dm$period=="Last Winter",]$period <- "Last"
iw.dm[iw.dm$period=="First Monsoon",]$period <- "First"
iw.dm[iw.dm$period=="Last Monsoon",]$period <- "Last"
iw.dm[iw.dm$season=="First Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="Last Winter",]$season <- "Winter"
iw.dm[iw.dm$season=="First Monsoon",]$season <- "Monsoon"
iw.dm[iw.dm$season=="Last Monsoon",]$season <- "Monsoon"
#changing year #Make a new variable with this
iw.dm$year <- iw.dm$sampling_year
iw.dm[iw.dm$year=="2017-2018",]$year <- "Water Year 1"
iw.dm[iw.dm$year=="2018-2019",]$year <- "Water Year 2"
iw.dm[iw.dm$year=="2019-2020",]$year <- "Water Year 3"
#remove field blanks. to remove anything, type !="Value" to remove them.
iw.dm <- iw.dm[iw.dm$type!="B", ]
#remove ATS samples because ATS samples are not included in PH research.
iw.dm <- iw.dm[iw.dm$site!="ATS1", ]
#remove year 3 monsoon samples
iw.dm$ssnyear <- paste(iw.dm$season, iw.dm$year)
iw.dm <- iw.dm[iw.dm$ssnyear!="Monsoon Water Year 3", ]
#confirm correct order of categorical variables
#iw.dm$samplings <- factor(iw.dm$samplings, levels = c("FW", "LW", "FM", "LM"))
iw.dm$samplings <- factor(iw.dm$samplings, levels = c("First Winter", "Last Winter", "First Monsoon", "Last Monsoon"))
iw.dm$period <- factor(iw.dm$period, levels = c("First", "Last"))
iw.dm$season <- factor(iw.dm$season, levels = c("Winter", "Monsoon"))
iw.dm$sampling_year <- factor(iw.dm$sampling_year, levels = c("Water Year 1", "Water Year 2", "Water Year 3"))
iw.dm$community <- factor(iw.dm$community, levels = c("Dewey-Humboldt", "Globe/Miami", "Hayden/Winkelman", "Tucson"))
#
iw.pHec <- read_xlsx("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_clean/IW_pHEC_Y123.xlsx", sheet = 1, col_names = TRUE)
iw.pHec <- iw.pHec[iw.pHec$type!="B",] #removing field blanks
iw.dm <- full_join(iw.dm, iw.pHec, by = c("sample.name", "type")) #joins the phec data with the original iw.dm we had before
iw.dm <- iw.dm[!is.na(iw.dm$community),]
# na.omit(iw.dm$community)
#add mining community vs urban community
iw.dm$landuse <- "Mining Community"
iw.dm[iw.dm$community=="Tucson",]$landuse <- "Urban Community"
com <- read_xlsx("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/LATLOGSITE.xlsx", sheet = "community", col_names = TRUE)
iw.dm <- full_join(iw.dm, com, by = c("site"))
iw.dm <- iw.dm[!is.na(iw.dm$mlod.name),]
pli <- read.csv("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/pollution_load_selected_analytes.csv")
iw.dm$pli <- pli$pli_contaminants
#outliers ----
#remove samples 19 and 39 from analysis because they were outliers based on MFA and remove all samples from H22 because they are a proximity outlier south of Winkelman
#G428IWA23-20190730 and H209IWA23-20190709
iw.dm <- iw.dm[-c(19,39),]
iw.dm <- iw.dm[iw.dm$site!="H222",]
#contamination factor=====
pli_dat<- pli[-c(19,39),]
pli_dat <- pli_dat[pli_dat$site!="H222",]
pli_short<-  pli_dat[, -c(15, 19, 25, 26, 28, 29)]
pli_dat2<- pivot_longer(pli_short,
cols = Be:Pb,
values_to = "contamination_factor",
names_to = "analytes")
#longer ----
iw.dm.long <- pivot_longer(iw.dm,
cols = Be:Pb,
values_to = "value",
names_to = "analyte")
#calculate natural log ----
iw.dm.long$ln_value <- log(iw.dm.long$value)
#create longer version to compare transformation
iw.dm.longer <- pivot_longer(data = iw.dm.long,
cols = c(value,ln_value),
names_to = "transformation",
values_to = "concentration")
iw.dm.longer[iw.dm.longer$transformation == "value",]$transformation <- "untransformed"
iw.dm.longer[iw.dm.longer$transformation == "ln_value",]$transformation <- "natural log"
iw.dm.longer$transformation <- as.factor(iw.dm.longer$transformation)
#create natural log dataframes for analysis
iw.ln.dm.long <- subset(iw.dm.long, select = -c(value))
iw.ln.dm <- pivot_wider(data = iw.ln.dm.long,
values_from = "ln_value",
names_from ="analyte")
hds <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/IO_HDS.xlsx")
#load in data and if there is a missing value, assume participant does not follow best practices - conservative estimate. No is a zero. Yes is a 1
#assumption: this index assumes equal influence of each best practice on rainwater quality
#assumption/limitation: we assume that the maintenance action reported was consistent across the duration of the study
##Q67 Do you clean parts of your roof draining system (like the debris filter, gutters, scuppers, etc.)? ----
hds$Q67 <- as.character(hds$Q67)
hds[is.na(hds$Q67),]$Q67 <- "0"
hds[hds$Q67=="0",]$Q67 <- "0"
hds[hds$Q67=="1",]$Q67 <- "1"
hds[hds$Q67=="2",]$Q67 <- "0"
hds$Q67 <- as.numeric(hds$Q67)
summary(hds$Q67)
##Q71 Do you treat or wash your cistern with anything? ----
hds$Q71 <- as.character(hds$Q71)
hds[is.na(hds$Q71),]$Q71 <- "0"
hds[hds$Q71=="0",]$Q71 <- "0"
hds[hds$Q71=="1",]$Q71 <- "1"
hds[hds$Q71=="2",]$Q71 <- "0"
hds$Q71 <- as.numeric(hds$Q71)
summary(hds$Q71)
##Q76 Does your cistern have a first flush? ----
hds$Q76 <- as.character(hds$Q76)
hds[is.na(hds$Q76),]$Q76 <- "0"
hds[hds$Q76=="0",]$Q76 <- "0"
hds[hds$Q76=="1",]$Q76 <- "1"
hds[hds$Q76=="2",]$Q76 <- "0"
hds[hds$Q76=="3",]$Q76 <- "0"
hds$Q76 <- as.numeric(hds$Q76)
summary(hds$Q76)
##Q77 Does your cistern have a screen/filter for incoming water from down spout on top of the tank? ----
hds$Q77 <- as.character(hds$Q77)
hds[is.na(hds$Q77),]$Q77 <- "0"
hds[hds$Q77=="0",]$Q77 <- "0"
hds[hds$Q77=="1",]$Q77 <- "1"
hds[hds$Q77=="2",]$Q77 <- "0"
hds[hds$Q77=="3",]$Q77 <- "0"
hds$Q77 <- as.numeric(hds$Q77)
summary(hds$Q77)
##Q79 Do you ever NOT remove the screen/filter and leave your cistern without the filter? ----
##question edited so that the Y/N response goes the same direction as the other questions
hds$Q79 <- as.character(hds$Q79)
hds[is.na(hds$Q79),]$Q79 <- "0"
hds[hds$Q79=="0",]$Q79 <- "0"
hds[hds$Q79=="1",]$Q79 <- "0"
hds[hds$Q79=="2",]$Q79 <- "1"
hds[hds$Q79=="100",]$Q79 <- "0"
hds$Q79 <- as.numeric(hds$Q79)
summary(hds$Q79)
hds$score <- hds$Q67 + hds$Q71 + hds$Q76 + hds$Q77 + hds$Q79
hds$score <- as.character(hds$score)
hds$score_bin <- hds$score
hds[hds$score_bin=="1",]$score_bin <- "1-2"
hds[hds$score_bin=="2",]$score_bin <- "1-2"
hds[hds$score_bin=="3",]$score_bin <- "3-5"
hds[hds$score_bin=="4",]$score_bin <- "3-5"
hds[hds$score_bin=="5",]$score_bin <- "3-5"
hds$score_bin <- as.factor(hds$score_bin)
summary(hds$score_bin)
iw.score <- full_join(iw.dm, hds, by = c("site"))
#write.csv(iw.score, "score_test.csv")
iw.score <- iw.score[!is.na(iw.score$score_bin),]
iw.score <- iw.score[!is.na(iw.score$community),]
table(iw.score$score_bin, iw.score$community)
iw.score <- full_join(iw.dm, hds, by = c("site"))
hds <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/IO_HDS.xlsx")
#load in data and if there is a missing value, assume participant does not follow best practices - conservative estimate. No is a zero. Yes is a 1
#assumption: this index assumes equal influence of each best practice on rainwater quality
#assumption/limitation: we assume that the maintenance action reported was consistent across the duration of the study
##Q67 Do you clean parts of your roof draining system (like the debris filter, gutters, scuppers, etc.)? ----
hds$Q67 <- as.character(hds$Q67)
hds[is.na(hds$Q67),]$Q67 <- "0"
hds[hds$Q67=="0",]$Q67 <- "0"
hds[hds$Q67=="1",]$Q67 <- "1"
hds[hds$Q67=="2",]$Q67 <- "0"
hds$Q67 <- as.numeric(hds$Q67)
summary(hds$Q67)
##Q71 Do you treat or wash your cistern with anything? ----
hds$Q71 <- as.character(hds$Q71)
hds[is.na(hds$Q71),]$Q71 <- "0"
hds[hds$Q71=="0",]$Q71 <- "0"
hds[hds$Q71=="1",]$Q71 <- "1"
hds[hds$Q71=="2",]$Q71 <- "0"
hds$Q71 <- as.numeric(hds$Q71)
summary(hds$Q71)
##Q76 Does your cistern have a first flush? ----
hds$Q76 <- as.character(hds$Q76)
hds[is.na(hds$Q76),]$Q76 <- "0"
hds[hds$Q76=="0",]$Q76 <- "0"
hds[hds$Q76=="1",]$Q76 <- "1"
hds[hds$Q76=="2",]$Q76 <- "0"
hds[hds$Q76=="3",]$Q76 <- "0"
hds$Q76 <- as.numeric(hds$Q76)
summary(hds$Q76)
##Q77 Does your cistern have a screen/filter for incoming water from down spout on top of the tank? ----
hds$Q77 <- as.character(hds$Q77)
hds[is.na(hds$Q77),]$Q77 <- "0"
hds[hds$Q77=="0",]$Q77 <- "0"
hds[hds$Q77=="1",]$Q77 <- "1"
hds[hds$Q77=="2",]$Q77 <- "0"
hds[hds$Q77=="3",]$Q77 <- "0"
hds$Q77 <- as.numeric(hds$Q77)
summary(hds$Q77)
##Q79 Do you ever NOT remove the screen/filter and leave your cistern without the filter? ----
##question edited so that the Y/N response goes the same direction as the other questions
hds$Q79 <- as.character(hds$Q79)
hds[is.na(hds$Q79),]$Q79 <- "0"
hds[hds$Q79=="0",]$Q79 <- "0"
hds[hds$Q79=="1",]$Q79 <- "0"
hds[hds$Q79=="2",]$Q79 <- "1"
hds[hds$Q79=="100",]$Q79 <- "0"
hds$Q79 <- as.numeric(hds$Q79)
summary(hds$Q79)
hds[hds$Q67=="NA",]$Q67 <- "0"
hds[hds$Q67==NA,]$Q67 <- "0"
rlang::last_trace()
summary(as.factor(hds$Q67))
hds <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/IO_HDS.xlsx")
#load in data and if there is a missing value, assume participant does not follow best practices - conservative estimate. No is a zero. Yes is a 1
#assumption: this index assumes equal influence of each best practice on rainwater quality
#assumption/limitation: we assume that the maintenance action reported was consistent across the duration of the study
##Q67 Do you clean parts of your roof draining system (like the debris filter, gutters, scuppers, etc.)? ----
hds$Q67 <- as.character(hds$Q67)
hds[is.na(hds$Q67),]$Q67 <- "0"
hds[hds$Q67=="0",]$Q67 <- "0"
hds[hds$Q67=="1",]$Q67 <- "1"
hds[hds$Q67=="2",]$Q67 <- "0"
hds$Q67 <- as.numeric(hds$Q67)
summary(hds$Q67)
##Q71 Do you treat or wash your cistern with anything? ----
hds$Q71 <- as.character(hds$Q71)
hds[is.na(hds$Q71),]$Q71 <- "0"
hds[hds$Q71=="0",]$Q71 <- "0"
hds[hds$Q71=="1",]$Q71 <- "1"
hds[hds$Q71=="2",]$Q71 <- "0"
hds$Q71 <- as.numeric(hds$Q71)
summary(hds$Q71)
##Q76 Does your cistern have a first flush? ----
hds$Q76 <- as.character(hds$Q76)
hds[is.na(hds$Q76),]$Q76 <- "0"
hds[hds$Q76=="0",]$Q76 <- "0"
hds[hds$Q76=="1",]$Q76 <- "1"
hds[hds$Q76=="2",]$Q76 <- "0"
hds[hds$Q76=="3",]$Q76 <- "0"
hds$Q76 <- as.numeric(hds$Q76)
summary(hds$Q76)
##Q77 Does your cistern have a screen/filter for incoming water from down spout on top of the tank? ----
hds$Q77 <- as.character(hds$Q77)
hds[is.na(hds$Q77),]$Q77 <- "0"
hds[hds$Q77=="0",]$Q77 <- "0"
hds[hds$Q77=="1",]$Q77 <- "1"
hds[hds$Q77=="2",]$Q77 <- "0"
hds[hds$Q77=="3",]$Q77 <- "0"
hds$Q77 <- as.numeric(hds$Q77)
summary(hds$Q77)
##Q79 Do you ever NOT remove the screen/filter and leave your cistern without the filter? ----
##question edited so that the Y/N response goes the same direction as the other questions
hds$Q79 <- as.character(hds$Q79)
hds[is.na(hds$Q79),]$Q79 <- "0"
hds[hds$Q79=="0",]$Q79 <- "0"
hds[hds$Q79=="1",]$Q79 <- "0"
hds[hds$Q79=="2",]$Q79 <- "1"
hds[hds$Q79=="100",]$Q79 <- "0"
hds$Q79 <- as.numeric(hds$Q79)
summary(hds$Q79)
hds$score <- hds$Q67 + hds$Q71 + hds$Q76 + hds$Q77 + hds$Q79
hds$score <- as.character(hds$score)
hds[hds$score=="NA",]$score <- "0"
hds <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/IO_HDS.xlsx")
#load in data and if there is a missing value, assume participant does not follow best practices - conservative estimate. No is a zero. Yes is a 1
#assumption: this index assumes equal influence of each best practice on rainwater quality
#assumption/limitation: we assume that the maintenance action reported was consistent across the duration of the study
##Q67 Do you clean parts of your roof draining system (like the debris filter, gutters, scuppers, etc.)? ----
hds$Q67 <- as.character(hds$Q67)
hds[is.na(hds$Q67),]$Q67 <- "0"
hds[hds$Q67=="0",]$Q67 <- "0"
hds[hds$Q67=="1",]$Q67 <- "1"
hds[hds$Q67=="2",]$Q67 <- "0"
hds$Q67 <- as.numeric(hds$Q67)
summary(hds$Q67)
##Q71 Do you treat or wash your cistern with anything? ----
hds$Q71 <- as.character(hds$Q71)
hds[is.na(hds$Q71),]$Q71 <- "0"
hds[hds$Q71=="0",]$Q71 <- "0"
hds[hds$Q71=="1",]$Q71 <- "1"
hds[hds$Q71=="2",]$Q71 <- "0"
hds$Q71 <- as.numeric(hds$Q71)
summary(hds$Q71)
##Q76 Does your cistern have a first flush? ----
hds$Q76 <- as.character(hds$Q76)
hds[is.na(hds$Q76),]$Q76 <- "0"
hds[hds$Q76=="0",]$Q76 <- "0"
hds[hds$Q76=="1",]$Q76 <- "1"
hds[hds$Q76=="2",]$Q76 <- "0"
hds[hds$Q76=="3",]$Q76 <- "0"
hds$Q76 <- as.numeric(hds$Q76)
summary(hds$Q76)
##Q77 Does your cistern have a screen/filter for incoming water from down spout on top of the tank? ----
hds$Q77 <- as.character(hds$Q77)
hds[is.na(hds$Q77),]$Q77 <- "0"
hds[hds$Q77=="0",]$Q77 <- "0"
hds[hds$Q77=="1",]$Q77 <- "1"
hds[hds$Q77=="2",]$Q77 <- "0"
hds[hds$Q77=="3",]$Q77 <- "0"
hds$Q77 <- as.numeric(hds$Q77)
summary(hds$Q77)
##Q79 Do you ever NOT remove the screen/filter and leave your cistern without the filter? ----
##question edited so that the Y/N response goes the same direction as the other questions
hds$Q79 <- as.character(hds$Q79)
hds[is.na(hds$Q79),]$Q79 <- "0"
hds[hds$Q79=="0",]$Q79 <- "0"
hds[hds$Q79=="1",]$Q79 <- "0"
hds[hds$Q79=="2",]$Q79 <- "1"
hds[hds$Q79=="100",]$Q79 <- "0"
hds$Q79 <- as.numeric(hds$Q79)
summary(hds$Q79)
hds$score <- hds$Q67 + hds$Q71 + hds$Q76 + hds$Q77 + hds$Q79
hds$score <- as.character(hds$score)
summary(as.factor(hds$score))
hds[hds$score=="NA",]$score <- "0"
summary(as.factor(hds$score))
hds$score_bin <- hds$score
hds[hds$score_bin=="1",]$score_bin <- "1-2"
hds[hds$score_bin=="2",]$score_bin <- "1-2"
hds[hds$score_bin=="3",]$score_bin <- "3-5"
hds[hds$score_bin=="4",]$score_bin <- "3-5"
hds[hds$score_bin=="5",]$score_bin <- "3-5"
hds$score_bin <- as.factor(hds$score_bin)
summary(hds$score_bin)
hds$score_bin <- hds$score
hds[hds$score_bin=="0",]$score_bin <- "None"
hds[hds$score_bin=="1",]$score_bin <- "Medium"
hds[hds$score_bin=="2",]$score_bin <- "Medium"
hds[hds$score_bin=="3",]$score_bin <- "High"
hds[hds$score_bin=="4",]$score_bin <- "High"
hds[hds$score_bin=="5",]$score_bin <- "High"
hds$score_bin <- as.factor(hds$score_bin)
summary(hds$score_bin)
hds$score_bin <- hds$score
hds[hds$score_bin=="0",]$score_bin <- "None"
hds[hds$score_bin=="1",]$score_bin <- "Medium"
hds[hds$score_bin=="2",]$score_bin <- "Medium"
hds[hds$score_bin=="3",]$score_bin <- "High"
hds[hds$score_bin=="4",]$score_bin <- "High"
hds[hds$score_bin=="5",]$score_bin <- "High"
hds$score_bin <- actor(hds$score_bin, levels = c("None", "Medium", "High"))
hds$score_bin <- factor(hds$score_bin, levels = c("None", "Medium", "High"))
summary(hds$score_bin)
iw.score <- full_join(iw.dm, hds, by = c("site"))
summary(iw.score$score_bin)
#write.csv(iw.score, "score_test.csv")
iw.score[iw.score$score_bin=="NA",]$score_bin <- "None"
#write.csv(iw.score, "score_test.csv")
iw.score[is.na(iw.score$score_bin),]$score_bin <- "None"
summary(iw.score$score_bin)
iw.score <- iw.score[!is.na(iw.score$community),]
table(iw.score$score_bin, iw.score$community)
hds <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/IO_HDS.xlsx")
library(readxl)
hds <- read_excel("~/Documents/GitHub/ProjectHarvest/WorkingFiles/data/data_processing/IO_HDS.xlsx")
View(hds)
